ssh -i ~/Documents/EECS\ 4480/eecs_server.pem ubuntu@ec2-35-183-239-72.ca-central-1.compute.amazonaws.com

https://www.digitalocean.com/community/tutorials/how-to-install-the-apache-web-server-on-ubuntu-18-04

sudo apt update
sudo apt upgrade
sudo apt install apache2
sudo apt install awstats libgeo-ip-perl libgeo-ipfree-perl
sudo systemctl status apache2

sudo mkdir /var/www/eecs
sudo chown -R $USER:$USER /var/www/eecs
sudo chmod -R 755 /var/www/eecs
nano /var/www/eecs/index.html
sudo nano /etc/apache2/sites-available/eecs.conf

<VirtualHost *:80>
    ServerAdmin saaniaki@my.yorku.ca
    ServerName <domain_name>
    ServerAlias www.<domain_name>
    DocumentRoot /var/www/eecs
    ErrorLog ${APACHE_LOG_DIR}/eecs_error.log
    CustomLog ${APACHE_LOG_DIR}/eecs_access.log combined
    Alias /awstatsclasses "/usr/share/awstats/lib/"
    Alias /awstats-icon/ "/usr/share/awstats/icon/"
    Alias /awstatscss "/usr/share/doc/awstats/examples/css"
    ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
    ScriptAlias /awstats/ /usr/lib/cgi-bin/
    Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch

    <Directory "/usr/lib/cgi-bin/">
        AuthUserFile /etc/apache2/htpasswd
        AuthName "Please Enter Your Password"
        AuthType Basic
        Require valid-user
    </Directory>

</VirtualHost>

sudo a2ensite eecs.conf
sudo a2dissite 000-default.conf
sudo apache2ctl configtest
sudo systemctl restart apache2
# Only on localhost:
# sudo nano /etc/hosts # add the domain to 127.0.0.1

# test website should be live

sudo a2enmod cgi
sudo systemctl restart apache2

Now follow https://www.linuxbabe.com/ubuntu/install-awstats-ubuntu-18-04-apache (Configuring AWStats)

sudo cp /etc/awstats/awstats.conf /etc/awstats/awstats.<domain_name>.conf
sudo nano /etc/awstats/awstats.<domain_name>.conf
# LogFile="/var/log/apache2/eecs_access.log"
# LogFormat=1
# SiteDomain="<domain_name>"
# HostAliases="<domain_name> localhost 127.0.0.1"
sudo setfacl -R -m "u:www-data:rx" /var/log/apache2/

Now <domain_name>/cgi-bin/awstats.pl should be accessible

sudo htpasswd -c /etc/apache2/htpasswd admin


update from UI (config): sudo nano /etc/awstats/awstats.ec2-35-183-239-72.ca-central-1.compute.amazonaws.com.conf
# set AllowToUpdateStatsFromBrowser to 1
update from UI (permission): sudo setfacl -m "u:www-data:rx" /var/log/apache2/eecs_access.log 


check for access log: cat /var/log/apache2/eecs_access.log | grep "GET /p1.html"